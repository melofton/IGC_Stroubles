---
title: "Lag and Hysteresis Graphs"
author: "Colin Baciocco"
date: "7/15/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load( gridExtra )
```


```{r make and save a lag graph for each storm}

stormdata <- filter(B1, Storm_ID == "2013-01-15 02:00:00")


p_discharge <- ggplot( stormdata ) +
  coord_cartesian( ylim = c(0, max(B1$Discharge) ) ) +
  geom_path( mapping = aes( x = DateTime, y = Discharge ), color = "blue")


p_Turb <- ggplot( stormdata ) +
  coord_cartesian( ylim = c(0, max( subset( B1$Turb_NTU, !is.na(B1$Turb_NTU) ) ) ) ) +
  geom_path( mapping = aes( x = DateTime, y = Turb_NTU), color = "brown")


#save as grobs and plot over one another.
#ggplot is philosophically against -- and doesn't allow -- plotting two datasets with different scales in the same graph. so I'll need to plot things separately.
gD <- ggplotGrob(p_discharge)
# gD <- gtable_add_cols(gD, unit(0,"mm")) # add a column for missing legend
gT <- ggplotGrob(p_Turb)
g <- rbind(gD, gT) # stack the two plots
g$widths <- unit.pmax(gD$widths, gT$widths) # use the largest widths
# center the legend vertically
g$layout[grepl("guide", g$layout$name),c("t","b")] <- c(1,nrow(g))
grid.newpage()
grid.draw(g)


#use the basic plotting function to get around ggplot's objections
plot( stormdata$DateTime, y = stormdata$Discharge, type = "l", col = "blue") 
lines( stormdata$DateTime, y = stormdata$Turb_NTU / max(stormdata$Turb_NTU), col = "brown")
```