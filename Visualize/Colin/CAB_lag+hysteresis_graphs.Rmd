---
title: "Lag and Hysteresis Graphs"
author: "Colin Baciocco"
date: "7/15/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load( grid, gridExtra )
```

#The code below relies on a version of B1 (the finalized sheet) with a column where storms have been identified

```{r make and save figures with graphs for discharge + hysteresis for each storm}

#get a unique list of storm starts. Ensure Na is not included.
stormstarts <- B1$Storm_ID[!is.na(B1$Storm_ID)] %>% unique()

loopstart <- Sys.time()

#Loop through each storm, graphing and saving each one.
for( ID in stormstarts){
  
  stormdata <- filter(B1, Storm_ID == ID)
  
  p_discharge <- ggplot( stormdata ) +
    coord_cartesian( ylim = c(0, max(B1$Discharge) ) ) +
    geom_path( mapping = aes( x = DateTime, y = Discharge ), color = "blue")
  
  p_spcond <- ggplot( stormdata ) +
    coord_cartesian( ylim = c(0, max( B1$SpCond_uScm[!is.na(B1$SpCond_uScm)] ) ) ) +
    geom_path( mapping = aes( x = DateTime, y = SpCond_uScm, color = "brown") )
  
  hyst <- ggplot( stormdata, aes(x = Discharge, y = SpCond_uScm, color = DateTime) ) +
    geom_point() +
    geom_path()
  
  p <- arrangeGrob( arrangeGrob(p_discharge, p_spcond, nrow = 2), hyst, nrow = 2 )
  png( paste( "./Storm Plots/", ID, ".png", sep = "" ),
       width = 8, height = 10, units = "in", res = 200)
  grid.draw(p)
}

graphics.off()
print( "Graphing Completed in", Sys.time() - loopstart )
rm(p_discharge, p_spcond, hyst, p, ID, stormstarts, stormdata)
```